{% extends "base.html" %}

{% block content %}
<div class="container" style="margin-top: 2rem;">
    <!-- Player Header -->
    <div style="margin-bottom: 2rem;">
        <h1 style="margin-bottom: 0.5rem;">{{ player.name }}</h1>
        <p style="color: var(--text-secondary);">
            Player ID: #{{ player.id }} |
            <span class="status-badge {% if player.status == 'Official' %}status-live{% else %}status-upcoming{% endif %}">
                {{ player.status }}
            </span>
        </p>
    </div>

    <!-- Stats Overview -->
    <div class="grid grid-4" style="margin-bottom: 2rem;">
        <div class="card" style="text-align: center;">
            <div style="font-size: 3rem; font-weight: 700; color: var(--accent-purple); margin-bottom: 0.5rem;">
                {{ "%.1f"|format(player.elo) }}
            </div>
            <div style="color: var(--text-secondary);">Current ELO</div>
            <div style="color: var(--text-muted); font-size: 0.9rem; margin-top: 0.25rem;">
                Peak: {{ "%.1f"|format(player.peak_elo) }}
            </div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 3rem; font-weight: 700; color: var(--primary-blue); margin-bottom: 0.5rem;">
                {{ player.games_played }}
            </div>
            <div style="color: var(--text-secondary);">Total Games</div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 3rem; font-weight: 700; color: var(--success); margin-bottom: 0.5rem;">
                {{ player.wins }}W
            </div>
            <div style="color: var(--text-secondary);">Wins</div>
        </div>
        <div class="card" style="text-align: center;">
            <div style="font-size: 3rem; font-weight: 700; color: {% if player.win_rate >= 0.6 %}var(--success){% elif player.win_rate >= 0.5 %}var(--warning){% else %}var(--danger){% endif %}; margin-bottom: 0.5rem;">
                {{ "%.1f"|format(player.win_rate * 100) }}%
            </div>
            <div style="color: var(--text-secondary);">Win Rate</div>
        </div>
    </div>

    <!-- Radar Attributes -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="card-header">玩家屬性</div>
        <div class="card-body">
            <div class="grid grid-5">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-blue);">{{ "%.0f"|format(player.skill) }}</div>
                    <div style="color: var(--text-secondary); margin-top: 0.5rem;">Skill</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent-purple);">{{ "%.0f"|format(player.consistency) }}</div>
                    <div style="color: var(--text-secondary); margin-top: 0.5rem;">Consistency</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--warning);">{{ "%.0f"|format(player.experience) }}</div>
                    <div style="color: var(--text-secondary); margin-top: 0.5rem;">Experience</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--success);">{{ "%.0f"|format(player.clutch) }}</div>
                    <div style="color: var(--text-secondary); margin-top: 0.5rem;">Clutch</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--danger);">{{ "%.0f"|format(player.top_cut) }}</div>
                    <div style="color: var(--text-secondary); margin-top: 0.5rem;">Top Cut</div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-2" style="align-items: start;">
        <!-- Deck Usage -->
        <div class="card">
            <div class="card-header">牌組使用統計</div>
            <div class="card-body">
                {% if deck_stats %}
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border-color); text-align: left;">
                            <th style="padding: 0.75rem;">牌組</th>
                            <th style="padding: 0.75rem;">次數</th>
                            <th style="padding: 0.75rem;">戰績</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for deck_name, times_used, total_wins, total_losses in deck_stats %}
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 0.75rem;">{{ deck_name }}</td>
                            <td style="padding: 0.75rem;">{{ times_used }}次</td>
                            <td style="padding: 0.75rem;">
                                <span style="color: var(--success);">{{ total_wins or 0 }}W</span> -
                                <span style="color: var(--danger);">{{ total_losses or 0 }}L</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p style="text-align: center; color: var(--text-secondary); padding: 2rem;">暫無牌組資料</p>
                {% endif %}
            </div>
        </div>

        <!-- Recent Tournaments -->
        <div class="card">
            <div class="card-header">近期賽事</div>
            <div class="card-body">
                {% if tournament_participations %}
                {% for tp in tournament_participations %}
                <div style="padding: 0.75rem; border-bottom: 1px solid var(--border-color);">
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">
                        <a href="{{ url_for('tournament.view', tournament_id=tp.tournament.id) }}" style="color: var(--primary-blue); text-decoration: none;">
                            {{ tp.tournament.name }}
                        </a>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        {{ tp.tournament.date.strftime('%Y-%m-%d') }} |
                        {{ tp.wins }}W-{{ tp.losses }}L-{{ tp.ties }}T |
                        {{ tp.points }} 分
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p style="text-align: center; color: var(--text-secondary); padding: 2rem;">暫無參賽記錄</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ELO History -->
    {% if elo_history %}
    <div class="card" style="margin-top: 2rem;">
        <div class="card-header">ELO 變化歷史（最近 50 筆）</div>
        <div class="card-body">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border-color); text-align: left;">
                        <th style="padding: 0.75rem;">時間</th>
                        <th style="padding: 0.75rem;">賽事</th>
                        <th style="padding: 0.75rem;">變化前</th>
                        <th style="padding: 0.75rem;">變化後</th>
                        <th style="padding: 0.75rem;">變化值</th>
                    </tr>
                </thead>
                <tbody>
                    {% for history in elo_history %}
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 0.75rem;">{{ history.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td style="padding: 0.75rem;">{{ history.tournament.name if history.tournament else '-' }}</td>
                        <td style="padding: 0.75rem;">{{ "%.1f"|format(history.elo_before) }}</td>
                        <td style="padding: 0.75rem;">{{ "%.1f"|format(history.elo_after) }}</td>
                        <td style="padding: 0.75rem;">
                            <span style="color: {% if history.elo_change > 0 %}var(--success){% else %}var(--danger){% endif %};">
                                {{ "%+.1f"|format(history.elo_change) }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <div style="margin-top: 2rem;">
        <a href="{{ url_for('analytics.leaderboard') }}" class="btn btn-outline">← 返回排行榜</a>
    </div>
</div>
{% endblock %}
